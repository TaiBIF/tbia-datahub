# ============================================
# TBIA PostgreSQL 最佳化配置
# 針對：76GB 資料庫、2 CPU cores、15.6GB RAM
# ============================================

# 網路設定 (重要!)
listen_addresses = 'localhost,postgres-datahub'  # 更安全的設定
port = 5432                            # PostgreSQL 埠號

# 記憶體設定 (核心最佳化)
shared_buffers = 2GB                    # 從 128MB 大幅提升
effective_cache_size = 10GB             # 從 4GB 提升  
work_mem = 512MB                        # 從 256MB 提升
maintenance_work_mem = 1600MB           # 維護記憶體

# WAL 最佳化 (寫入效能)
wal_buffers = 64MB                      
max_wal_size = 4GB                      # 從 1GB 提升
min_wal_size = 1GB                      
checkpoint_completion_target = 0.9       
checkpoint_timeout = 15min              

# SSD 最佳化 (關鍵改善)
random_page_cost = 1.1                  # 從 4.0 降低到 1.1
effective_io_concurrency = 8            # 針對 2 CPU

# 2 CPU 並行設定
max_worker_processes = 2                
max_parallel_workers_per_gather = 1     
max_parallel_workers = 2                

# 自動清理 (大型資料庫)
autovacuum = on                         
autovacuum_max_workers = 1              
autovacuum_naptime = 30s                

# 效能提升設定
synchronous_commit = off                # 非同步提交
log_min_duration_statement = 1000       # 監控慢查詢

# 連接設定
max_connections = 100                   # 最大連接數
